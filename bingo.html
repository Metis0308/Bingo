<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>ãƒŠã‚¤ãƒˆãƒ¬ã‚¤ãƒ³ãƒ“ãƒ³ã‚´</title>
<style> :root { --btn-grad: linear-gradient(135deg, #4facfe, #00f2fe); --btn-glow: 0 0 12px #4facfe; } body { font-family: "Segoe UI", sans-serif; background: radial-gradient(circle at top, #2b2b40, #111); color: #fff; padding: 20px; } h1 { text-shadow: 0 0 10px #6cf; } /* ===== ãƒœã‚¿ãƒ³ ===== */ button { background: var(--btn-grad); border: none; border-radius: 20px; padding: 8px 18px; color: #000; font-weight: bold; cursor: pointer; box-shadow: var(--btn-glow); transition: 0.2s; } button:hover { transform: translateY(-2px); box-shadow: 0 0 20px #6cf; } button:active { transform: translateY(1px); box-shadow: 0 0 6px #6cf inset; } select { background: #111; color: #fff; border: 1px solid #555; padding: 6px; } /* ===== ãƒ“ãƒ³ã‚´ç›¤ ===== */ .board { display: grid; gap: 8px; max-width: 650px; margin-top: 15px; } .cell { background: linear-gradient(145deg, #ffffff25, #00000055); border: 2px solid #888; border-radius: 12px; padding: 10px; min-height: 85px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; box-shadow: inset 0 0 10px #000; } .cell.checked { background: linear-gradient(145deg, #3cff6a, #1f8f3f); color: #000; box-shadow: 0 0 14px #3cff6a; } .cell.bingo-line { border-color: gold; box-shadow: 0 0 20px gold; } .bingo { font-size: 26px; margin-top: 10px; color: gold; text-shadow: 0 0 12px gold; } /* ===== ã‚¨ãƒ‡ã‚£ã‚¿ ===== */ .editor { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; margin-top: 25px; } .editor textarea { width: 100%; height: 140px; background: #0d0d14; color: #fff; border: 1px solid #555; border-radius: 8px; padding: 8px; } .editor-controls { margin-top: 10px; } /* ===== OBS ===== */ body.obs { background: transparent; } body.obs h1, body.obs .controls, body.obs .editor, body.obs .editor-controls { display: none; } body.obs .board { margin-top: 0; max-width: 100%; } </style>
</head>

<body>

<h1>ELDEN RING NIGHTREIGN BINGO</h1>

<div class="controls">
  ã‚µã‚¤ã‚º:
  <select id="sizeSelect">
    <option value="3">3Ã—3</option>
    <option value="5" selected>5Ã—5</option>
  </select>
  <button onclick="generateBoard()">ç”Ÿæˆ</button>
  <button id="obsToggleBtn" onclick="toggleOBS()">ğŸ¥ OBSãƒ¢ãƒ¼ãƒ‰</button>
</div>

<div id="board" class="board"></div>
<div id="bingoText" class="bingo"></div>

<h2>ğŸ›  ã‚¿ã‚¹ã‚¯ã‚«ãƒ†ã‚´ãƒª</h2>
<p>â€» ç©ºã‚«ãƒ†ã‚´ãƒªã¯ä»–ã‚«ãƒ†ã‚´ãƒª or FREE ã‚’è‡ªå‹•å‚ç…§</p>

<div class="editor" id="editor"></div>

<div class="editor-controls">
  <button onclick="addCategory()">ï¼‹ ã‚«ãƒ†ã‚´ãƒªè¿½åŠ </button>
  <button onclick="applyTasks()">ã‚¿ã‚¹ã‚¯åæ˜ ï¼ˆå†ç”Ÿæˆï¼‰</button>
</div>

<script>
/* =====================
   DOMå‚ç…§
===================== */
const els = {
  board: document.getElementById("board"),
  bingo: document.getElementById("bingoText"),
  editor: document.getElementById("editor"),
  size: document.getElementById("sizeSelect"),
  obsBtn: document.getElementById("obsToggleBtn")
};

/* =====================
   çŠ¶æ…‹
===================== */
const state = {
  isOBS: false,
  centerTasks: [
    "è¿½è·¡è€…ã‚’ä½¿ç”¨ã™ã‚‹","å®ˆè­·è€…ã‚’ä½¿ç”¨ã™ã‚‹","ãƒ¬ãƒ‡ã‚£ã‚’ä½¿ç”¨ã™ã‚‹","éš è€…ã‚’ä½¿ç”¨ã™ã‚‹",
    "é‰„ã®ç›®ã‚’ä½¿ç”¨ã™ã‚‹","ç„¡é ¼æ¼¢ã‚’ä½¿ç”¨ã™ã‚‹","åŸ·è¡Œè€…ã‚’ä½¿ç”¨ã™ã‚‹",
    "å¾©è®è€…ã‚’ä½¿ç”¨ã™ã‚‹","å­¦è€…ã‚’ä½¿ç”¨ã™ã‚‹","è‘¬å„€å±‹ã‚’ä½¿ç”¨ã™ã‚‹"
  ],
  categories: {
    B: ["æ•µã‚’30ä½“ä»¥ä¸Šå€’ã™","ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒœã‚¹ã‚’3ä½“ä»¥ä¸Šå€’ã™","ä¸­å¤®ç ¦ã®ãƒœã‚¹ã‚’å€’ã™","éœŠé·¹ã®æ­¢ã¾ã‚Šæœ¨ã‚’ä½¿ç”¨ã™ã‚‹","éœŠè„ˆã‚’3ã‹æ‰€ä½¿ç”¨ã™ã‚‹"],
    C: ["æ•™ä¼šã‚’1ã‹æ‰€è¨ªã‚Œã‚‹","é­”è¡“å¸«å¡”ã‚’1ã‹æ‰€é–‹æ”¾ã™ã‚‹","å°ç‰¢2ã‹æ‰€ã‚‚ã—ãã¯ç½åŸŸã‚’æ”»ç•¥ã™ã‚‹"],
    D: ["ã‚¹ã‚«ãƒ©ãƒ™ã‚’1ä½“å€’ã™","åŸ‹ã‚‚ã‚ŒãŸå®ã‚’1å€‹é–‹ã‘ã‚‹","éºè·¡ã‚’1ã‹æ‰€æ”»ç•¥ã™ã‚‹"]
  }
};

/* =====================
   util
===================== */
const shuffle = a => a.slice().sort(() => Math.random() - 0.5);
const encode = o => btoa(unescape(encodeURIComponent(JSON.stringify(o))));
const decode = s => JSON.parse(decodeURIComponent(escape(atob(s))));

/* =====================
   åˆæœŸåŒ–
===================== */
function init() {
  const params = new URLSearchParams(location.search);

  state.isOBS = params.has("obs");
  applyOBSState();

  if (params.has("data")) {
    try {
      const restored = decode(params.get("data"));
      state.categories = restored.categories ?? state.categories;
      state.centerTasks = restored.centerTasks ?? state.centerTasks;
      els.size.value = restored.size ?? els.size.value;

      buildEditor();
      generateBoard(restored);
      return;
    } catch (e) {
      console.error("å¾©å…ƒå¤±æ•—", e);
    }
  }

  buildEditor();
  generateBoard();
}

/* =====================
   OBS
===================== */
function toggleOBS() {
  state.isOBS = !state.isOBS;
  applyOBSState();
  updateURL();
}

function applyOBSState() {
  document.body.classList.toggle("obs", state.isOBS);
  els.obsBtn.textContent =
    state.isOBS ? "ğŸ¥ OBSãƒ¢ãƒ¼ãƒ‰ï¼šON" : "ğŸ¥ OBSãƒ¢ãƒ¼ãƒ‰ï¼šOFF";
}

/* =====================
   ã‚¨ãƒ‡ã‚£ã‚¿
===================== */
function buildEditor() {
  els.editor.innerHTML = `
    <div>
      <h3>â­ ã‚»ãƒ³ã‚¿ãƒ¼å°‚ç”¨</h3>
      <textarea id="center_tasks">${state.centerTasks.join("\n")}</textarea>
    </div>
  `;

  Object.keys(state.categories).forEach(k => {
    els.editor.insertAdjacentHTML("beforeend", `
      <div>
        <h3>${k}</h3>
        <textarea id="cat_${k}">${state.categories[k].join("\n")}</textarea>
      </div>
    `);
  });
}

/* =====================
   ãƒ“ãƒ³ã‚´ç”Ÿæˆ
===================== */
function buildUniqueTaskPool() {
  return [...new Set(Object.values(state.categories).flat())];
}

function generateBoard(fromData = null) {
  const size = fromData?.size ?? Number(els.size.value);
  els.board.innerHTML = "";
  els.bingo.textContent = "";
  els.board.style.gridTemplateColumns = `repeat(${size},1fr)`;

  const total = size * size;
  const center = Math.floor(total / 2);
  let result;

  if (fromData?.board?.length === total) {
    result = fromData.board.slice();
  } else {
    result = new Array(total).fill("FREE");
    result[center] = shuffle(state.centerTasks)[0] ?? "FREE";

    let pool = shuffle(buildUniqueTaskPool());
    for (let i = 0; i < total; i++) {
      if (i !== center && pool.length) result[i] = pool.shift();
    }
  }

  result.forEach((task, i) => {
    const c = document.createElement("div");
    c.className = "cell";
    c.textContent = task;

    if (fromData?.checked?.includes(i)) c.classList.add("checked");

    c.onclick = () => {
      c.classList.toggle("checked");
      checkBingo(size);
      updateURL();
    };

    els.board.appendChild(c);
  });

  checkBingo(size);
  updateURL();
}

/* =====================
   ãƒ“ãƒ³ã‚´åˆ¤å®šï¼ˆå¤‰æ›´ãªã—ï¼‰
===================== */
function checkBingo(size) {
  const cells = [...document.querySelectorAll(".cell")];
  cells.forEach(c => c.classList.remove("bingo-line"));

  const lines = [];
  for (let r = 0; r < size; r++) lines.push([...Array(size)].map((_, c) => r * size + c));
  for (let c = 0; c < size; c++) lines.push([...Array(size)].map((_, r) => r * size + c));
  lines.push([...Array(size)].map((_, i) => i * size + i));
  lines.push([...Array(size)].map((_, i) => i * size + (size - 1 - i)));

  let bingo = false;
  lines.forEach(l => {
    if (l.every(i => cells[i].classList.contains("checked"))) {
      bingo = true;
      l.forEach(i => cells[i].classList.add("bingo-line"));
    }
  });

  els.bingo.textContent = bingo ? "ğŸ‰ BINGO !!! ğŸ‰" : "";
}

/* =====================
   URL
===================== */
function updateURL() {
  const cells = [...document.querySelectorAll(".cell")];

  const data = {
    size: Number(els.size.value),
    categories: state.categories,
    centerTasks: state.centerTasks,
    board: cells.map(c => c.textContent),
    checked: cells.map((c,i)=>c.classList.contains("checked")?i:null).filter(v=>v!==null)
  };

  history.replaceState(null,"",
    `?data=${encode(data)}${state.isOBS ? "&obs=1" : ""}`);
}

/* =====================
   æ“ä½œ
===================== */
function applyTasks() {
  state.centerTasks =
    document.getElementById("center_tasks").value.split("\n").filter(Boolean);

  Object.keys(state.categories).forEach(k => {
    state.categories[k] =
      document.getElementById(`cat_${k}`).value.split("\n").filter(Boolean);
  });

  generateBoard();
}

function addCategory() {
  const name = prompt("ã‚«ãƒ†ã‚´ãƒªå")?.trim();
  if (!name || state.categories[name]) return;
  state.categories[name] = [];
  buildEditor();
  updateURL();
}

/* èµ·å‹• */
init();
</script>

</body>
</html>


